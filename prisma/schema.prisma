generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        String   @id @default(uuid())
  email     String   @unique
  password  String
  role      Role
  active    Boolean  @default(true)
  createdAt DateTime @default(now())
}

model Bill {
  id             String          @id @default(uuid())
  userId         String
  period         String
  consumptionM3  Float
  fixedAmount    Float
  variableAmount Float
  totalAmount    Float
  status         BillStatus      @default(PENDING)
  createdAt      DateTime        @default(now())
  payments       PaymentIntent[]
}

model PaymentIntent {
  id                String          @id @default(uuid())
  billId            String
  provider          PaymentProvider
  currency          String          @default("BOB")
  amount            Float
  status            PaymentStatus   @default(CREATED)
  externalReference String?
  expiresAt         DateTime
  createdAt         DateTime        @default(now())
  confirmedAt       DateTime?
  bill              Bill            @relation(fields: [billId], references: [id])

  @@index([billId])
  @@index([externalReference])
}

enum Role {
  ADMIN
  OPERATOR
  CASHIER
}

enum BillStatus {
  PENDING
  PAID
  CANCELLED
}

enum PaymentStatus {
  CREATED
  PENDING
  CONFIRMED
  FAILED
  EXPIRED
}

enum PaymentProvider {
  QR_BNB
  QR_BCP
  QR_SIMPLE
}
